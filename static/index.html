<!DOCTYPE html>
<html>
  <head>
    <title>Proxy Service</title>
    <link rel="icon" href="https://glitch.com/favicon.ico" />
    <meta charset="utf-8" />
  </head>
  <body>
    This is a proxy service. Rejoice! Go to: <input type="text" id="go" /><button
      id="button"
    >
      Go!</button
    ><br />
    <span id="cookie"></span>
    <span id="error" style="color: red"></span>
    <script type="module">
      import { isValidURL } from "./utils.js";
      
      alert("Poop")
      const input = document.getElementById("go");
      const error = document.getElementById("error");
      const button = document.getElementById("button");
      const cookie = document.getElementById("cookie")
      
      const list = {}
      document.cookie.split(`;`).forEach(function(cookie) {
        let [ name, ...rest] = cookie.split(`=`);
        name = name?.trim();
        if (!name) return;
        const value = rest.join(`=`).trim();
        if (!value) return;
        list[name] = decodeURIComponent(value);
    });
      cookie.innerHTML = JSON.stringify(list)

      button.onclick = () => {
        if (isValidURL(input.value)) {
          // 1. get the base url
          const url = new URL(input.value)
          document.cookie = `baseURL=${url.origin}`
          window.location.href = window.location.origin + url.pathname
        } else {
          error.innerHTML = "Oops, that is not a valid url. Try again!";
        }
      };
    </script>
  </body>
</html>
